#!/bin/bash
# Verificación FINAL del parche CVE-2025-55182

echo "╔═══════════════════════════════════════╗"
echo "║   VERIFICACIÓN FINAL CVE-2025-55182  ║"
echo "╚═══════════════════════════════════════╝"
echo ""

cd /var/www/muva-chat-tst

echo "Versiones actuales:"
grep -E '"next"|"react"' package.json
echo ""

NEXT_VERSION=$(grep '"next"' package.json | sed 's/.*: *"\([^"]*\)".*/\1/')
REACT_VERSION=$(grep '"react"' package.json | sed 's/.*: *"\^*\([^"]*\)".*/\1/')

echo "Next.js: $NEXT_VERSION"
echo "React: $REACT_VERSION"
echo ""

# Verificar si están parcheadas
VULNERABLE=false

if [[ "$NEXT_VERSION" == "15.5.3" ]]; then
    echo "❌ Next.js VULNERABLE (necesita 15.5.7)"
    VULNERABLE=true
else
    echo "✓ Next.js parcheado"
fi

if [[ "$REACT_VERSION" == "19.2.0" ]]; then
    echo "❌ React VULNERABLE (necesita 19.2.1)"
    VULNERABLE=true
else
    echo "✓ React parcheado"
fi

echo ""

if [ "$VULNERABLE" = true ]; then
    echo "╔═══════════════════════════════════════╗"
    echo "║   ⚠️  ACCIÓN REQUERIDA               ║"
    echo "╚═══════════════════════════════════════╝"
    echo ""
    echo "CVE-2025-55182 NO está parcheado."
    echo "Necesitas ejecutar el parche manualmente."
    echo ""
    echo "Ejecuta: /root/parche-cve-manual.sh"
else
    echo "╔═══════════════════════════════════════╗"
    echo "║   ✅ CVE-2025-55182 PARCHEADO        ║"
    echo "╚═══════════════════════════════════════╝"
    echo ""
    echo "VPS COMPLETAMENTE PROTEGIDO"
fi
