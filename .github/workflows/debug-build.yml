name: Debug Build on VPS

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Try Build on VPS
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.PROD_VPS_HOST }}
          username: ${{ secrets.PROD_VPS_USER }}
          key: ${{ secrets.PROD_VPS_SSH_KEY }}
          port: 2244
          command_timeout: 15m
          script: |
            cd /var/www/muva-chat-prd

            echo "ðŸ“¦ Current commit:"
            git log -1 --oneline

            echo ""
            echo "ðŸ“¦ Checking Node/pnpm versions:"
            node --version
            pnpm --version

            echo ""
            echo "ðŸ“¦ Attempting build..."
            pnpm run build 2>&1 | tee /tmp/build-output.log || true

            echo ""
            echo "=== BUILD OUTPUT ==="
            cat /tmp/build-output.log
