name: Test Node Versions

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Test with different Node versions
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.PROD_VPS_HOST }}
          username: ${{ secrets.PROD_VPS_USER }}
          key: ${{ secrets.PROD_VPS_SSH_KEY }}
          port: 2244
          command_timeout: 20m
          script: |
            cd /var/www/muva-chat-prd

            echo "=== Current Node version ==="
            node --version

            echo ""
            echo "=== Check if nvm is installed ==="
            if [ -f ~/.nvm/nvm.sh ]; then
              echo "NVM is installed"
              . ~/.nvm/nvm.sh
              nvm list

              echo ""
              echo "=== Try build with Node 20 ==="
              nvm use 20 || echo "Node 20 not installed"
              node --version
              ./node_modules/.bin/next build 2>&1 | head -50 || true
            else
              echo "NVM not installed"

              echo ""
              echo "=== Check available Node versions ==="
              which -a node

              echo ""
              echo "=== Try to find nodejs package ==="
              dpkg -l | grep nodejs || true
            fi

            echo ""
            echo "=== Check if there's a .nvmrc file ==="
            cat .nvmrc 2>/dev/null || echo "No .nvmrc file"
