name: Debug Build V2

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Test builds on VPS
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.PROD_VPS_HOST }}
          username: ${{ secrets.PROD_VPS_USER }}
          key: ${{ secrets.PROD_VPS_SSH_KEY }}
          port: 2244
          command_timeout: 20m
          script: |
            cd /var/www/muva-chat-prd

            echo "=== TEST 1: Build without turbopack ==="
            ./node_modules/.bin/next build 2>&1 || true

            echo ""
            echo "=== TEST 2: Check Node version ==="
            node --version
            which node

            echo ""
            echo "=== TEST 3: Check package.json engines ==="
            cat package.json | grep -A 5 '"engines"' || echo "No engines specified"

            echo ""
            echo "=== TEST 4: Check Next.js version ==="
            cat package.json | grep '"next"'

            echo ""
            echo "=== TEST 5: Try verbose build ==="
            NODE_OPTIONS="--trace-warnings" ./node_modules/.bin/next build 2>&1 | head -100 || true
