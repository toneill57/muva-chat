# CVE-2025-55182 (React2Shell) - Incident Response Plan

**Status:** üö® CRITICAL - Active Exploitation
**Date:** 2025-12-11
**Severity:** CVSS 10.0
**Impact:** Unauthenticated Remote Code Execution

---

## Executive Summary

Tu VPS ha sido comprometido mediante la explotaci√≥n de **CVE-2025-55182 (React2Shell)**, una vulnerabilidad cr√≠tica de RCE sin autenticaci√≥n en React Server Components que afecta Next.js por defecto.

**Confirmado:**
- ‚úÖ Next.js 15.5.3 vulnerable (fix: 15.5.7)
- ‚úÖ React 19.2.0 vulnerable (fix: 19.2.1)
- ‚úÖ VPS detenido por el proveedor debido a malware
- ‚úÖ Explotaci√≥n activa por APT chinos (Earth Lamia, Jackpot Panda)

---

## Threat Intelligence

### Atacantes Identificados
- **Earth Lamia** (China-nexus APT)
- **Jackpot Panda** (China-nexus APT)
- **Emerald Campaign** (cryptominers)
- **Nuts Campaign** (backdoors)

### Malware Desplegado
- Cobalt Strike beacons (C2 framework)
- Nezha agent (RAT)
- FRP (Fast Reverse Proxy)
- Sliver payload (C2 framework)
- Secret-Hunter (credential stealer)
- XMRig/C3Pool (cryptominers)

### Indicadores de Compromiso (IOCs)

**Procesos:**
```
xmrig, minerd, cpuminer, kinsing, c3pool, dbused, kdevtmpfsi
```

**Servicios systemd:**
```
log.service, update-service, miner.service, *c3pool*
```

**Directorios:**
```
/tmp/* (ejecutables)
/var/tmp/* (ejecutables)
/dev/shm/* (binarios)
```

**Conexiones de Red:**
```
Puertos: 3333, 4444, 5555, 7777, 8888, 14444, 45700 (mining pools)
```

---

## Incident Response Workflow

### FASE 1: Acceso y Contenci√≥n (URGENTE)

#### 1.1 Reiniciar VPS
```bash
# Accede al panel de tu proveedor de hosting
# Inicia el VPS manualmente
# El proveedor lo detuvo por actividad maliciosa
```

#### 1.2 Verificar Acceso SSH
```bash
./scripts/security-incident-response.sh
```

**Si falla:** El VPS a√∫n est√° detenido. Contacta al proveedor.

---

### FASE 2: Investigaci√≥n Forense

El script `security-incident-response.sh` ejecuta:

1. **An√°lisis de procesos** (top 20 CPU)
2. **Conexiones de red activas**
3. **B√∫squeda de criptomineros**
4. **Archivos ejecutables en /tmp, /var/tmp, /dev/shm**
5. **Servicios systemd sospechosos**
6. **Crontabs comprometidos**
7. **Historial de comandos**
8. **SSH authorized_keys**
9. **Logs de aplicaci√≥n**

**Output:** Reporte completo en `/tmp/muva-security-report-YYYYMMDD-HHMMSS.txt`

---

### FASE 3: Eliminaci√≥n de Malware

#### 3.1 Limpieza Autom√°tica
```bash
./scripts/security-incident-response.sh
# Cuando se solicite, responde 's' para ejecutar limpieza
```

**Acciones ejecutadas:**
- Detener procesos maliciosos (`pkill -9 xmrig|minerd|...`)
- Eliminar servicios systemd (`log.service`, etc.)
- Limpiar `/tmp`, `/var/tmp`, `/dev/shm`
- Backup y limpiar `.bash_history`

#### 3.2 Verificaci√≥n Manual (SSH directo)
```bash
sshpass -p 'Ololiuqui21+' ssh root@195.200.6.216

# Verificar procesos
ps aux --sort=-%cpu | head -20

# Verificar servicios
systemctl list-units --type=service --state=running

# Verificar conexiones
netstat -tulpn

# Verificar crontabs
crontab -l
ls -la /etc/cron.d/
```

---

### FASE 4: Parcheo de Vulnerabilidad

#### 4.1 Aplicar Fix en Codebase Local
```bash
./scripts/patch-react2shell.sh
```

**Cambios aplicados:**
- React: `19.2.0` ‚Üí `19.2.1` ‚úÖ
- React-DOM: `19.2.0` ‚Üí `19.2.1` ‚úÖ
- Next.js: `15.5.3` ‚Üí `15.5.7` ‚úÖ

#### 4.2 Commit y Deploy
```bash
git add package.json pnpm-lock.yaml
git commit -m "security: patch CVE-2025-55182 (React2Shell)

- Update React to 19.2.1 (fixes CVE-2025-55182)
- Update React-DOM to 19.2.1
- Update Next.js to 15.5.7
- Addresses CVSS 10.0 RCE vulnerability

ü§ñ Generated with Claude Code
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

git push origin main
```

#### 4.3 Deploy a VPS
```bash
# SSH al VPS
sshpass -p 'Ololiuqui21+' ssh root@195.200.6.216

# Actualizar aplicaci√≥n
cd /var/www/muva-chat
git pull origin main
pnpm install --frozen-lockfile
pnpm run build
pm2 restart all

# Verificar versiones
grep '"react":' package.json
grep '"next":' package.json
```

---

### FASE 5: Hardening del Servidor

#### 5.1 Cambiar Credenciales
```bash
# En el VPS
passwd  # Cambiar contrase√±a root
# Nueva contrase√±a FUERTE (min 16 chars, alfanum√©rica + s√≠mbolos)
```

#### 5.2 Configurar Fail2Ban
```bash
# En el VPS
apt update
apt install fail2ban -y

cat > /etc/fail2ban/jail.local << 'EOF'
[DEFAULT]
bantime = 24h
findtime = 10m
maxretry = 3
banaction = ufw

[sshd]
enabled = true
port = ssh
maxretry = 3
bantime = 72h

[nginx-http-auth]
enabled = true
port = http,https
maxretry = 3
EOF

systemctl restart fail2ban
fail2ban-client status
```

#### 5.3 Hardening SSH
```bash
# En el VPS
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

cat >> /etc/ssh/sshd_config << 'EOF'
# Security Hardening
MaxAuthTries 3
LoginGraceTime 30
ClientAliveInterval 300
ClientAliveCountMax 2
X11Forwarding no
AllowTcpForwarding no
PermitEmptyPasswords no
PasswordAuthentication no  # Usar solo SSH keys
PubkeyAuthentication yes
EOF

systemctl restart sshd
```

#### 5.4 Actualizar Firewall (UFW)
```bash
# En el VPS
ufw default deny incoming
ufw default allow outgoing
ufw allow 22/tcp comment 'SSH'
ufw allow 80/tcp comment 'HTTP'
ufw allow 443/tcp comment 'HTTPS'
ufw --force enable
ufw status verbose
```

#### 5.5 Instalar AIDE (Intrusion Detection)
```bash
# En el VPS
apt install aide -y
aideinit
cp /var/lib/aide/aide.db.new /var/lib/aide/aide.db

# Configurar cron para verificaci√≥n diaria
cat > /etc/cron.daily/aide << 'EOF'
#!/bin/bash
aide --check | mail -s "AIDE Report for $(hostname)" your-email@example.com
EOF

chmod +x /etc/cron.daily/aide
```

---

### FASE 6: Monitoreo Continuo

#### 6.1 Configurar Alertas de Seguridad
```bash
# En el VPS
apt install logwatch -y

cat > /etc/cron.daily/logwatch << 'EOF'
#!/bin/bash
/usr/sbin/logwatch --output mail --mailto your-email@example.com --detail high
EOF

chmod +x /etc/cron.daily/logwatch
```

#### 6.2 Script de Monitoreo de Procesos
```bash
# En el VPS
cat > /root/monitor-malware.sh << 'EOF'
#!/bin/bash
# Buscar procesos sospechosos cada 5 minutos

SUSPICIOUS=$(ps aux | grep -iE 'xmrig|minerd|cpuminer|kinsing|c3pool' | grep -v grep)

if [ ! -z "$SUSPICIOUS" ]; then
    echo "ALERTA: Proceso sospechoso detectado en $(hostname)" | mail -s "SECURITY ALERT" your-email@example.com
    echo "$SUSPICIOUS" >> /var/log/malware-alerts.log
    pkill -9 -f 'xmrig|minerd|cpuminer|kinsing|c3pool'
fi
EOF

chmod +x /root/monitor-malware.sh

# Agregar a crontab
(crontab -l 2>/dev/null; echo "*/5 * * * * /root/monitor-malware.sh") | crontab -
```

#### 6.3 Health Check Endpoint
Verificar que `/api/health/database` est√° respondiendo:

```bash
curl -s https://muva-chat.com/api/health/database | jq
```

Debe retornar:
```json
{
  "status": "healthy",
  "database": "connected",
  "rpc_functions": "valid"
}
```

---

## Post-Incident Checklist

- [ ] VPS reiniciado y accesible
- [ ] Reporte forense generado y revisado
- [ ] Malware eliminado (verificado)
- [ ] CVE-2025-55182 parcheado (React 19.2.1, Next.js 15.5.7)
- [ ] Aplicaci√≥n desplegada en VPS
- [ ] Contrase√±a root cambiada
- [ ] Fail2Ban configurado
- [ ] SSH hardening aplicado
- [ ] Firewall actualizado (UFW)
- [ ] AIDE instalado y configurado
- [ ] Alertas de seguridad configuradas
- [ ] Monitoreo continuo activo
- [ ] Health checks pasando
- [ ] SSH keys regeneradas (eliminar password auth)

---

## Mejores Pr√°cticas (Post-Remediation)

### 1. Autenticaci√≥n Solo por SSH Keys
```bash
# En tu m√°quina local
ssh-keygen -t ed25519 -C "muva-vps-secure"
ssh-copy-id -i ~/.ssh/id_ed25519.pub root@195.200.6.216

# En el VPS: Deshabilitar password auth
sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
systemctl restart sshd
```

### 2. Actualizaciones Autom√°ticas
```bash
# En el VPS
apt install unattended-upgrades -y
dpkg-reconfigure -plow unattended-upgrades
```

### 3. Monitoreo de Dependencias
```bash
# En tu proyecto local
pnpm audit
pnpm outdated

# Revisar semanalmente
```

### 4. GitHub Security Alerts
- Habilitar Dependabot en el repositorio
- Configurar notificaciones de vulnerabilidades

### 5. Rate Limiting en Nginx
```nginx
# /etc/nginx/sites-available/muva-chat
limit_req_zone $binary_remote_addr zone=general:10m rate=10r/s;

server {
    location / {
        limit_req zone=general burst=20 nodelay;
        # ... resto de la config
    }
}
```

---

## Referencias

### Advisories Oficiales
- [React Security Advisory](https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components)
- [Next.js CVE-2025-66478](https://nextjs.org/blog/CVE-2025-66478)
- [Vercel Summary](https://vercel.com/changelog/cve-2025-55182)
- [CISA Alert](https://www.cisa.gov/news-events/alerts/2025/12/05/cisa-adds-one-known-exploited-vulnerability-catalog)

### An√°lisis T√©cnico
- [Checkmarx Deep Dive](https://checkmarx.com/zero-post/react2shell-cve-2025-55182-deserialization-to-remote-code-execution-in-react-and-next-js/)
- [Wiz Research](https://www.wiz.io/blog/nextjs-cve-2025-55182-react2shell-deep-dive)
- [Trend Micro Analysis](https://www.trendmicro.com/en_us/research/25/l/CVE-2025-55182-analysis-poc-itw.html)
- [AWS Threat Intel](https://aws.amazon.com/blogs/security/china-nexus-cyber-threat-groups-rapidly-exploit-react2shell-vulnerability-cve-2025-55182/)

### Exploit Details
- [PeerBlight Backdoor](https://www.huntress.com/blog/peerblight-linux-backdoor-exploits-react2shell)
- [React2Shell.com](https://react2shell.com/)

---

## Contacto y Soporte

Si necesitas asistencia adicional:

1. **Proveedor VPS:** Contabo/Hetzner support
2. **Security Team:** Reportar incidente a abuse@proveedor.com
3. **Logs:** Revisar `/tmp/muva-security-report-*.txt`

---

**Last Updated:** 2025-12-11
**Status:** Active Incident Response
