#!/usr/bin/env tsx
/**
 * Compare functions between staging (old) and PRD (new)
 */

const staging = [
  "check_accommodation_type_hotel_match",
  "check_event_overlap",
  "check_metadata_integrity",
  "check_rls_policies",
  "check_rls_status",
  "check_sire_access_permission",
  "check_sire_data_completeness",
  "check_slow_queries",
  "cleanup_old_sync_logs",
  "cosine_distance",
  "create_accommodation_unit",
  "exec_sql",
  "execute_sql",
  "get_accommodation_tenant_id",
  "get_accommodation_unit_by_id",
  "get_accommodation_unit_by_motopress_id",
  "get_accommodation_unit_by_name",
  "get_accommodation_units",
  "get_accommodation_units_by_ids",
  "get_accommodation_units_by_tenant",
  "get_accommodation_units_needing_type_id",
  "get_active_integration",
  "get_archived_conversations_to_delete",
  "get_availability",
  "get_conversation_messages",
  "get_full_document",
  "get_guest_conversation_metadata",
  "get_inactive_conversations",
  "get_real_accommodation_units_by_tenant",
  "get_reservations_by_external_id",
  "get_sire_guest_data",
  "get_sire_monthly_export",
  "get_sire_statistics",
  "get_tenant_schema",
  "hamming_distance",
  "has_tenant_feature",
  "hnsw_bit_support",
  "hnsw_halfvec_support",
  "hnsw_sparsevec_support",
  "hnswhandler",
  "inner_product",
  "insert_accommodation_unit",
  "ivfflat_bit_support",
  "ivfflat_halfvec_support",
  "ivfflathandler",
  "jaccard_distance",
  "l1_distance",
  "l2_distance",
  "l2_norm",
  "l2_normalize",
  "list_rls_policies",
  "log_changes",
  "log_manual_analytics_event",
  "map_hotel_to_public_accommodation_id",
  "map_hotel_to_public_accommodation_id_v1",
  "map_hotel_to_public_accommodation_id_v2",
  "map_public_to_hotel_accommodation_id",
  "match_accommodation_units_balanced",
  "match_accommodation_units_fast",
  "match_accommodations_guest",
  "match_accommodations_hybrid",
  "match_accommodations_public",
  "match_conversation_memory",
  "match_documents",
  "match_documents_with_tenant",
  "match_guest_accommodations",
  "match_guest_information_balanced",
  "match_hotel_content",
  "match_hotel_documents",
  "match_hotel_general_info",
  "match_hotel_operations_balanced",
  "match_hotels_documents",
  "match_hotels_documents_optimized",
  "match_hotels_with_tier_routing",
  "match_listings_documents",
  "match_muva_activities",
  "match_muva_documents",
  "match_muva_documents_public",
  "match_optimized_documents",
  "match_policies",
  "match_policies_public",
  "match_simmerdown_documents",
  "match_sire_documents",
  "match_tenant_muva_documents",
  "match_unified_documents",
  "match_unit_manual",
  "match_unit_manual_chunks",
  "propagate_parent_booking",
  "search_code_embeddings",
  "search_hotels_by_tenant",
  "search_muva_attractions",
  "search_muva_restaurants",
  "search_tenant_embeddings",
  "set_app_tenant_id",
  "simulate_app_tenant_access",
  "subvector",
  "sync_accommodation_units_public_to_hotels",
  "test_ddl_execution",
  "test_tenant_isolation_simple",
  "update_accommodation_units_manual_updated_at",
  "update_airbnb_motopress_comparison_updated_at",
  "update_conversation_attachments_updated_at",
  "update_conversation_timestamp",
  "update_updated_at_column",
  "upsert_accommodation",
  "validate_pricing_rule"
];

const prd = [
  "auto_link_reservation_accommodation",
  "check_accommodation_type_hotel_match",
  "check_event_overlap",
  "check_metadata_integrity",
  "check_rls_policies",
  "check_rls_status",
  "check_sire_access_permission",
  "check_sire_data_completeness",
  "check_slow_queries",
  "cleanup_old_sync_logs",
  "cosine_distance",
  "create_accommodation_unit",
  "exec_sql",
  "execute_sql",
  "get_accommodation_tenant_id",
  "get_accommodation_unit_by_id",
  "get_accommodation_unit_by_motopress_id",
  "get_accommodation_unit_by_name",
  "get_accommodation_units",
  "get_accommodation_units_by_ids",
  "get_accommodation_units_by_tenant",
  "get_accommodation_units_needing_type_id",
  "get_active_integration",
  "get_archived_conversations_to_delete",
  "get_availability",
  "get_conversation_messages",
  "get_full_document",
  "get_guest_conversation_metadata",
  "get_inactive_conversations",
  "get_real_accommodation_units_by_tenant",
  "get_reservations_by_external_id",
  "get_sire_guest_data",
  "get_sire_monthly_export",
  "get_sire_statistics",
  "get_tenant_schema",
  "hamming_distance",
  "has_tenant_feature",
  "hnsw_bit_support",
  "hnsw_halfvec_support",
  "hnsw_sparsevec_support",
  "hnswhandler",
  "inner_product",
  "insert_accommodation_unit",
  "ivfflat_bit_support",
  "ivfflat_halfvec_support",
  "ivfflathandler",
  "jaccard_distance",
  "l1_distance",
  "l2_distance",
  "l2_norm",
  "l2_normalize",
  "list_rls_policies",
  "log_changes",
  "map_hotel_to_public_accommodation_id",
  "map_hotel_to_public_accommodation_id_v1",
  "map_hotel_to_public_accommodation_id_v2",
  "map_public_to_hotel_accommodation_id",
  "match_accommodation_units_balanced",
  "match_accommodation_units_fast",
  "match_accommodations_guest",
  "match_accommodations_hybrid",
  "match_accommodations_public",
  "match_conversation_memory",
  "match_documents",
  "match_documents_with_tenant",
  "match_guest_accommodations",
  "match_guest_information_balanced",
  "match_hotel_content",
  "match_hotel_documents",
  "match_hotel_general_info",
  "match_hotel_operations_balanced",
  "match_hotels_documents",
  "match_hotels_documents_optimized",
  "match_hotels_with_tier_routing",
  "match_listings_documents",
  "match_muva_activities",
  "match_muva_documents",
  "match_muva_documents_public",
  "match_optimized_documents",
  "match_policies",
  "match_policies_public",
  "match_simmerdown_documents",
  "match_sire_documents",
  "match_tenant_muva_documents",
  "match_unified_documents",
  "match_unit_manual",
  "match_unit_manual_chunks",
  "propagate_parent_booking",
  "search_code_embeddings",
  "search_hotels_by_tenant",
  "search_muva_attractions",
  "search_muva_restaurants",
  "search_tenant_embeddings",
  "set_app_tenant_id",
  "simulate_app_tenant_access",
  "subvector",
  "sync_accommodation_units_public_to_hotels",
  "test_ddl_execution",
  "test_tenant_isolation_simple",
  "update_accommodation_units_manual_updated_at",
  "update_airbnb_motopress_comparison_updated_at",
  "update_conversation_attachments_updated_at",
  "update_conversation_timestamp",
  "update_updated_at_column",
  "upsert_accommodation",
  "validate_pricing_rule"
];

// Find missing in PRD
const missingInPrd = staging.filter(f => !prd.includes(f));

// Find extra in PRD (not in staging)
const extraInPrd = prd.filter(f => !staging.includes(f));

console.log('ðŸ“Š Function Comparison Report\n');
console.log(`Staging (old): ${staging.length} functions`);
console.log(`PRD (new): ${prd.length} functions\n`);

console.log('âŒ Missing in PRD (exist in staging):');
if (missingInPrd.length === 0) {
  console.log('   âœ… None - All staging functions exist in PRD');
} else {
  missingInPrd.forEach(f => console.log(`   - ${f}`));
}

console.log('\nâœ¨ Extra in PRD (new functions):');
if (extraInPrd.length === 0) {
  console.log('   - None');
} else {
  extraInPrd.forEach(f => console.log(`   - ${f}`));
}

console.log(`\nðŸ“ˆ Summary:`);
console.log(`   Missing: ${missingInPrd.length}`);
console.log(`   Extra: ${extraInPrd.length}`);
